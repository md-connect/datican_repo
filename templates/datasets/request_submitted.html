{% extends 'base.html' %}
{% load static %}
{% block title %}Request Submitted{% endblock %}

{% block extra_head %}
<style>
  /* Force the sidebar to be fixed properly */
  aside {
    position: fixed !important;
    left: 0 !important;
    top: 0 !important;
    height: 100vh !important;
    z-index: 50 !important;
  }
  
  .sticky-search {
    position: sticky;
    top: 0;
    z-index: 40;
    background: white;
    border-bottom: 1px solid #e5e7eb;
  }
  
  @media (max-width: 768px) {
    .sticky-search {
      top: 64px; /* Account for mobile header height */
      z-index: 30;
    }
    
    /* Hide auth buttons in search bar on mobile */
    .mobile-hide-auth {
      display: none !important;
    }
  }
</style>
{% endblock %}

{% block content %}
<main>
  <!-- Sticky Search Bar -->
  <div class="sticky-search py-4 bg-white px-4 sm:px-6">
    <div class="max-w-7xl mx-auto">
      <div class="flex items-center justify-between">
        <div class="flex-1 max-w-2xl">
          <div class="relative">
            <input 
              type="text" 
              placeholder="Search datasets..." 
              class="w-full px-4 py-3 pl-12 pr-32 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            >
            <svg class="absolute left-4 top-3.5 h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            
            <!-- Include the filter -->
            {% include 'datasets/filter_modal.html' %}
          </div>
        </div>
        
        <!-- User Authentication Buttons (Hidden on mobile) -->
        <div class="flex items-center space-x-4 ml-4 mobile-hide-auth">
          {% if user.is_authenticated %}
            <div class="relative group" x-data="{ profileOpen: false }">
              {% if user.profile.avatar %}
                <img
                  src="{{ user.profile.avatar.url }}"
                  class="h-10 w-10 rounded-full cursor-pointer border-2 border-transparent hover:border-primary"
                  @mouseenter="profileOpen = true"
                  @mouseleave="profileOpen = false"
                />
              {% else %}
                <div
                  class="h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center cursor-pointer border-2 border-transparent hover:border-primary"
                  @mouseenter="profileOpen = true"
                  @mouseleave="profileOpen = false"
                >
                  <span class="text-gray-600 font-medium">{{ user.username|first|upper }}</span>
                </div>
              {% endif %}
              
              <!-- Profile Dropdown -->
              <div
                x-show="profileOpen"
                @mouseenter="profileOpen = true"
                @mouseleave="profileOpen = false"
                x-cloak
                class="absolute right-0 mt-2 w-48 bg-white shadow-lg rounded-lg py-2 z-50"
                style="display: none;"
              >
                <a href="{% url 'profile' %}" class="block px-4 py-2 text-sm hover:bg-gray-100">My Profile</a>
                <a href="{% url 'account_change_password' %}" class="block px-4 py-2 text-sm hover:bg-gray-100">Change Password</a>
                <form action="{% url 'account_logout' %}" method="POST" class="block">
                  {% csrf_token %}
                  <button type="submit" class="w-full text-left px-4 py-2 text-sm hover:bg-gray-100">
                    Logout
                  </button>
                </form>
              </div>
            </div>
          {% else %}
            <div class="flex items-center space-x-3">
              <a href="{% url 'login' %}" class="text-dark hover:text-accent transition-colors font-medium">Sign In</a>
              <a href="{% url 'signup' %}" class="bg-accent text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors font-medium">Register</a>
            </div>
          {% endif %}
          
        </div>
        
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <!-- Breadcrumb -->
    <nav class="mb-6 flex items-center text-sm text-gray-600">
      <a href="{% url 'dataset_list' %}" class="hover:text-primary">Datasets</a>
      <svg class="w-4 h-4 mx-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
      <a href="{% url 'dataset_detail' dataset.id %}" class="hover:text-primary">{{ dataset.title|truncatechars:30 }}</a>
      <svg class="w-4 h-4 mx-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
      <span class="text-primary font-medium">Request Submitted</span>
    </nav>

    <!-- Success Message Card -->
    <div class="max-w-2xl mx-auto">
      <div class="bg-white rounded-lg shadow-sm p-8 text-center">
        <!-- Success Icon -->
        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <i data-lucide="check-circle" class="w-10 h-10 text-green-600"></i>
        </div>
        
        <!-- Success Heading -->
        <h2 class="text-2xl font-bold text-primary mb-4">Request Submitted Successfully!</h2>
        
        <!-- Success Message -->
        <div class="mb-8">
          <p class="text-gray-600 mb-4">
            Your request for access to <span class="font-semibold text-primary">{{ dataset.title }}</span> has been submitted and is now under review.
          </p>
          
          <!-- Request Details -->
          <div class="bg-gray-50 rounded-lg p-4 mb-6 text-left">
            <h3 class="text-sm font-medium text-gray-700 mb-2">Request Details:</h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-600">Request ID:</span>
                <span class="font-medium">{{ data_request.id }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Submitted:</span>
                <span class="font-medium">{{ data_request.request_date|date:"F j, Y H:i" }}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-600">Dataset:</span>
                <span class="font-medium">{{ dataset.title|truncatechars:40 }}</span>
              </div>
            </div>
          </div>
          
          <p class="text-gray-600">
            You will be redirected to the status page in <span id="countdown" class="font-semibold text-accent">5</span> seconds.
          </p>
        </div>
        
        <!-- What's Next Section -->
        <div class="bg-blue-50 rounded-lg p-6 mb-8 text-left">
          <h3 class="text-lg font-semibold text-primary mb-3 flex items-center gap-2">
            <i data-lucide="info" class="w-5 h-5 text-blue-600"></i>
            What happens next?
          </h3>
          <ol class="list-decimal list-inside space-y-3 text-gray-700">
            <li>Your request will be reviewed by our data management team</li>
            <li>You'll receive email notifications about status updates</li>
            <li>Once approved, you'll be able to download the dataset</li>
            <li>The review process typically takes 3-5 business days</li>
          </ol>
        </div>
        
        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="{% url 'request_status' data_request.pk %}" 
             class="bg-accent text-white px-8 py-3 rounded-lg hover:bg-accent/90 transition-colors font-medium flex items-center justify-center gap-2">
            <i data-lucide="eye" class="w-5 h-5"></i>
            View Request Status
          </a>
          <a href="{% url 'dataset_detail' dataset.id %}" 
             class="border border-primary text-primary px-8 py-3 rounded-lg hover:bg-blue-50 transition-colors font-medium flex items-center justify-center gap-2">
            <i data-lucide="arrow-left" class="w-5 h-5"></i>
            Back to Dataset
          </a>
        </div>
        
        <!-- Additional Links -->
        <div class="mt-8 pt-6 border-t border-gray-200">
          <p class="text-sm text-gray-500">
            Need help? <a href="#" class="text-accent hover:underline font-medium">Contact support</a> or 
            <a href="{% url 'dataset_list' %}" class="text-accent hover:underline font-medium">browse other datasets</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    lucide.createIcons();
    
    // Countdown timer
    let countdown = 5;
    const countdownElement = document.getElementById('countdown');
    
    if (countdownElement) {
      const countdownInterval = setInterval(function() {
        countdown--;
        countdownElement.textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(countdownInterval);
        }
      }, 1000);
    }
    
    // Redirect after 5 seconds
    setTimeout(function() {
      window.location.href = "{% url 'request_status' data_request.pk %}";
    }, 5000);
  });
</script>
{% endblock %}