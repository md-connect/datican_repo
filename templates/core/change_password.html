{% extends 'base.html' %}
{% load static %}
{% block title %}Change Password - Datican{% endblock %}

{% block content %}
<div class="min-h-screen flex flex-col items-center justify-center py-12 px-4 bg-gray-50">
  <div class="max-w-md w-full space-y-8">
    <!-- Password Change Card -->
    <div class="bg-white rounded-xl shadow-sm p-8 space-y-6">
      <!-- Header -->
      <div class="text-center">
        <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">
          Change Password
        </h2>
        <p class="mt-2 text-sm text-gray-600">
          Update your password to keep your account secure
        </p>
      </div>

      <!-- Messages -->
      {% if messages %}
      <div class="space-y-3">
        {% for message in messages %}
        <div class="p-3 rounded-lg {% if message.tags == 'success' %}bg-green-100 text-green-800 border border-green-200{% else %}bg-red-100 text-red-800 border border-red-200{% endif %}">
          {{ message }}
        </div>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Password Change Form -->
      <form class="space-y-6" method="POST">
        {% csrf_token %}

        <!-- Current Password Field -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Current Password
          </label>
          <input
            type="password"
            name="old_password"
            required
            class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"
            placeholder="Enter your current password"
          />
        </div>

        <!-- New Password Field -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            New Password
          </label>
          <input
            type="password"
            name="new_password1"
            required
            class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"
            placeholder="Enter new password"
          />
          <p class="mt-2 text-xs text-gray-500">
            Your password must be at least 8 characters long.
          </p>
        </div>

        <!-- Confirm New Password Field -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">
            Confirm New Password
          </label>
          <input
            type="password"
            name="new_password2"
            required
            class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"
            placeholder="Confirm new password"
          />
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="w-full bg-black text-white py-2.5 rounded-lg hover:bg-secondary transition-colors"
        >
          Change Password
        </button>
      </form>

      <!-- Back to Profile Link -->
      <div class="text-center">
        <a 
          href="{% url 'profile' %}" 
          class="text-sm text-gray-600 hover:text-primary"
        >
          ‚Üê Back to Profile
        </a>
      </div>
    </div>

    <!-- Security Tips -->
    <div class="bg-white rounded-xl shadow-sm p-6">
      <h3 class="text-sm font-medium text-gray-900 mb-3">Security Tips</h3>
      <ul class="space-y-2 text-sm text-gray-600">
        <li class="flex items-start">
          <svg class="w-5 h-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          Use a unique password you don't use elsewhere
        </li>
        <li class="flex items-start">
          <svg class="w-5 h-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          Consider using a password manager
        </li>
        <li class="flex items-start">
          <svg class="w-5 h-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          Never share your password with anyone
        </li>
        <li class="flex items-start">
          <svg class="w-5 h-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          Change your password regularly
        </li>
      </ul>
    </div>
  </div>
</div>

<!-- Simple password match validation -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const newPassword1 = document.querySelector('input[name="new_password1"]');
  const newPassword2 = document.querySelector('input[name="new_password2"]');
  const form = document.querySelector('form');
  
  function checkPasswordMatch() {
    if (newPassword1.value && newPassword2.value && newPassword1.value !== newPassword2.value) {
      newPassword2.setCustomValidity('Passwords do not match');
      return false;
    } else {
      newPassword2.setCustomValidity('');
      return true;
    }
  }
  
  if (newPassword2) {
    newPassword2.addEventListener('input', checkPasswordMatch);
  }
  
  if (form) {
    form.addEventListener('submit', function(e) {
      if (!checkPasswordMatch()) {
        e.preventDefault();
        alert('Passwords do not match. Please make sure both password fields are identical.');
        return false;
      }
      
      // Check password length
      if (newPassword1.value.length < 8) {
        e.preventDefault();
        alert('Password must be at least 8 characters long.');
        return false;
      }
      
      return true;
    });
  }
});
</script>
{% endblock %}