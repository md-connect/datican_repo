<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Data Request Status Update</title>
<style>
body { margin:0; padding:0; background:#F8FAFC; font-family:Arial, Helvetica, sans-serif; color:#333; }
table { border-collapse:collapse; }
a { text-decoration:none; color:inherit; }
img { border:0; display:block; }

@media only screen and (max-width:600px){
  .container { width:100% !important; }
  .padding { padding:24px !important; }
}
</style>
</head>

<body>

<table width="100%" bgcolor="#F8FAFC" cellpadding="0" cellspacing="0">
<tr>
<td align="center">

<!-- Container -->
<table width="620" class="container" bgcolor="#FFFFFF" cellpadding="0" cellspacing="0" style="border-radius:16px; overflow:hidden;">
    
    <!-- Header -->
    <tr>
        <td bgcolor="#0F172A" style="padding:40px 32px; text-align:center; color:#FFFFFF;">
            <div style="font-size:26px; font-weight:bold;">Data Request Status Update</div>
            <div style="font-size:16px; color:#FECACA; margin-top:8px;">Dear {{ user_display_name }},</div>
        </td>
    </tr>
    
    <!-- Body -->
    <tr>
        <td style="padding:40px 32px; color:#020617;">
            <!-- Status Badge -->
            <table align="center" cellpadding="0" cellspacing="0" style="margin:20px 0; border:1px solid #009b2c; background:#009b2c;">
                <tr>
                    <td style="padding:8px 18px; font-size:14px; font-weight:bold; color:#ffffff;">
                        Status Updated
                    </td>
                </tr>
            </table>

            <p style="font-size:16px; line-height:1.7; color:#475569;">
                Your data request status has been updated. Here are the details:
            </p>

            <!-- Status Card -->
            <table width="100%" cellpadding="0" cellspacing="0" style="margin:24px 0; background:#fafafa;">
                <tr>
                    <td style="padding:24px;">
                        <div style="font-size:18px; font-weight:bold; margin-bottom:16px; color:#0F172A;">Status Change Details</div>
                        
                        <!-- Previous / Current -->
                        <table width="100%" cellpadding="0" cellspacing="0" style="margin-bottom:20px;">
                            <tr>
                                <td width="50%" align="center" style="padding:8px;">
                                    <div style="width:40px; height:40px; border-radius:50%; background:#6B7280; color:#FFFFFF; line-height:40px; font-weight:bold; margin:0 auto;">←</div>
                                    <div style="font-size:15px; font-weight:bold; margin-top:4px;">{{ previous_status|title }}</div>
                                    <div style="font-size:12px; color:#6B7280;">Previous</div>
                                </td>
                                <td width="50%" align="center" style="padding:8px;">
                                    <div style="width:40px; height:40px; border-radius:50%; background:#E74C3C; color:#FFFFFF; line-height:40px; font-weight:bold; margin:0 auto;">→</div>
                                    <div style="font-size:15px; font-weight:bold; margin-top:4px;">{{ current_status|title }}</div>
                                    <div style="font-size:12px; color:#6B7280;">Current</div>
                                </td>
                            </tr>
                        </table>

                        <!-- Data Grid -->
                        <table width="100%" cellpadding="0" cellspacing="0">
                            <tr>
                                <td style="font-size:12px; color:#64748B; padding:8px 0;">Dataset</td>
                                <td style="font-size:15px; font-weight:bold; color:#1E293B; padding:8px 0;">{{ request.dataset.title }}</td>
                            </tr>
                            <tr>
                                <td style="font-size:12px; color:#64748B; padding:8px 0;">Updated By</td>
                                <td style="font-size:15px; font-weight:bold; color:#1E293B; padding:8px 0;">{{ updated_by_name }}</td>
                            </tr>
                            <tr>
                                <td style="font-size:12px; color:#64748B; padding:8px 0;">Update Date</td>
                                <td style="font-size:15px; font-weight:bold; color:#1E293B; padding:8px 0;">{{ update_date|date:"F d, Y H:i" }}</td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>

            <!-- Next Steps (3-Stage Progress) -->
            <table width="100%" cellpadding="0" cellspacing="0" role="presentation"
                style="background:#FFFFFF; padding:24px; margin:28px 0;">
                <tr>
                    <td style="padding:24px;">

                        <div style="font-size:18px; font-weight:bold; margin-bottom:20px; color:#0F172A;">
                            What Happens Next?
                        </div>

                        <!-- Stages Row -->
                        <table width="100%" cellpadding="0" cellspacing="0" role="presentation">
                            <tr valign="top" align="center">

                                {% if request.status == 'manager_review' %}
                                <!-- Stage 1: Manager Review (Active) -->
                                <td width="33%" style="padding:8px;">
                                    <div style="width:52px; height:52px; border-radius:50%;
                                                background:#E74C3C; color:#FFFFFF;
                                                line-height:52px; font-weight:bold; margin:0 auto;">
                                        1
                                    </div>
                                    <div style="margin-top:10px; font-weight:bold;">Manager Review</div>
                                    <div style="font-size:13px; color:#475569; margin-top:6px;">
                                        Your request is being reviewed by a data manager. You will be notified when a decision is made.
                                    </div>
                                </td>

                                <!-- Arrow -->
                                <td width="5%" style="font-size:20px; color:#94A3B8; padding-top:28px;">→</td>

                                <!-- Stage 2: Director Review (Inactive) -->
                                <td width="33%" style="padding:8px;">
                                    <div style="width:52px; height:52px; border-radius:50%;
                                                background:#E5E7EB; color:#64748B;
                                                line-height:52px; font-weight:bold; margin:0 auto;">
                                        2
                                    </div>
                                    <div style="margin-top:10px; font-weight:bold; color:#64748B;">Director Review</div>
                                    <div style="font-size:13px; color:#94A3B8; margin-top:6px;">
                                        After manager approval, it goes to director for final decision.
                                    </div>
                                </td>

                                <!-- Arrow -->
                                <td width="5%" style="font-size:20px; color:#94A3B8; padding-top:28px;">→</td>

                                <!-- Stage 3: Final Decision (Inactive) -->
                                <td width="33%" style="padding:8px;">
                                    <div style="width:52px; height:52px; border-radius:50%;
                                                background:#E5E7EB; color:#64748B;
                                                line-height:52px; font-weight:bold; margin:0 auto;">
                                        3
                                    </div>
                                    <div style="margin-top:10px; font-weight:bold; color:#64748B;">Final Decision</div>
                                    <div style="font-size:13px; color:#94A3B8; margin-top:6px;">
                                        You'll receive notification once a final decision is made.
                                    </div>
                                </td>
                                {% endif %}

                                {% if request.status == 'director_review' %}
                                <!-- Stage 1: Manager Review (Completed) -->
                                <td width="33%" style="padding:8px;">
                                    <div style="width:52px; height:52px; border-radius:50%;
                                                background:#16A34A; color:#FFFFFF;
                                                line-height:52px; font-weight:bold; margin:0 auto;">
                                        1
                                    </div>
                                    <div style="margin-top:10px; font-weight:bold;">Manager Review</div>
                                    <div style="font-size:13px; color:#475569; margin-top:6px;">
                                        Manager review completed successfully.
                                    </div>
                                </td>

                                <!-- Arrow -->
                                <td width="5%" style="font-size:20px; color:#94A3B8; padding-top:28px;">→</td>

                                <!-- Stage 2: Director Review (Active) -->
                                <td width="33%" style="padding:8px;">
                                    <div style="width:52px; height:52px; border-radius:50%;
                                                background:#E74C3C; color:#FFFFFF;
                                                line-height:52px; font-weight:bold; margin:0 auto;">
                                        2
                                    </div>
                                    <div style="margin-top:10px; font-weight:bold;">Director Review</div>
                                    <div style="font-size:13px; color:#475569; margin-top:6px;">
                                        The data manager has recommended your request. It is now awaiting final approval from the director.
                                    </div>
                                </td>

                                <!-- Arrow -->
                                <td width="5%" style="font-size:20px; color:#94A3B8; padding-top:28px;">→</td>

                                <!-- Stage 3: Final Decision (Inactive) -->
                                <td width="33%" style="padding:8px;">
                                    <div style="width:52px; height:52px; border-radius:50%;
                                                background:#E5E7EB; color:#64748B;
                                                line-height:52px; font-weight:bold; margin:0 auto;">
                                        3
                                    </div>
                                    <div style="margin-top:10px; font-weight:bold; color:#64748B;">Final Decision</div>
                                    <div style="font-size:13px; color:#94A3B8; margin-top:6px;">
                                        You'll receive notification once a final decision is made.
                                    </div>
                                </td>
                                {% endif %}

                                {% if request.status == 'approved' %}
                                <!-- Stage 1: Manager Review (Completed) -->
                                <td width="33%" style="padding:8px;">
                                    <div style="width:52px; height:52px; border-radius:50%;
                                                background:#16A34A; color:#FFFFFF;
                                                line-height:52px; font-weight:bold; margin:0 auto;">
                                        1
                                    </div>
                                    <div style="margin-top:10px; font-weight:bold;">Manager Review</div>
                                    <div style="font-size:13px; color:#475569; margin-top:6px;">
                                        Completed ✓
                                    </div>
                                </td>

                                <!-- Arrow -->
                                <td width="5%" style="font-size:20px; color:#94A3B8; padding-top:28px;">→</td>

                                <!-- Stage 2: Director Review (Completed) -->
                                <td width="33%" style="padding:8px;">
                                    <div style="width:52px; height:52px; border-radius:50%;
                                                background:#16A34A; color:#FFFFFF;
                                                line-height:52px; font-weight:bold; margin:0 auto;">
                                        2
                                    </div>
                                    <div style="margin-top:10px; font-weight:bold;">Director Review</div>
                                    <div style="font-size:13px; color:#475569; margin-top:6px;">
                                        Completed ✓
                                    </div>
                                </td>

                                <!-- Arrow -->
                                <td width="5%" style="font-size:20px; color:#94A3B8; padding-top:28px;">→</td>

                                <!-- Stage 3: Approved (Active) -->
                                <td width="33%" style="padding:8px;">
                                    <div style="width:52px; height:52px; border-radius:50%;
                                                background:#E74C3C; color:#FFFFFF;
                                                line-height:52px; font-weight:bold; margin:0 auto;">
                                        3
                                    </div>
                                    <div style="margin-top:10px; font-weight:bold;">Approved</div>
                                    <div style="font-size:13px; color:#475569; margin-top:6px;">
                                        Your request has been approved! You should receive a separate email with download instructions.
                                    </div>
                                </td>
                                {% endif %}

                                {% if request.status == 'rejected' %}
                                <!-- Stage 1: Manager Review (Completed) -->
                                <td width="33%" style="padding:8px;">
                                    <div style="width:52px; height:52px; border-radius:50%;
                                                background:#16A34A; color:#FFFFFF;
                                                line-height:52px; font-weight:bold; margin:0 auto;">
                                        1
                                    </div>
                                    <div style="margin-top:10px; font-weight:bold;">Manager Review</div>
                                    <div style="font-size:13px; color:#475569; margin-top:6px;">
                                        Completed ✓
                                    </div>
                                </td>

                                <!-- Arrow -->
                                <td width="5%" style="font-size:20px; color:#94A3B8; padding-top:28px;">→</td>

                                <!-- Stage 2: Director Review (Completed) -->
                                <td width="33%" style="padding:8px;">
                                    <div style="width:52px; height:52px; border-radius:50%;
                                                background:#16A34A; color:#FFFFFF;
                                                line-height:52px; font-weight:bold; margin:0 auto;">
                                        2
                                    </div>
                                    <div style="margin-top:10px; font-weight:bold;">Director Review</div>
                                    <div style="font-size:13px; color:#475569; margin-top:6px;">
                                        Completed ✓
                                    </div>
                                </td>

                                <!-- Arrow -->
                                <td width="5%" style="font-size:20px; color:#94A3B8; padding-top:28px;">→</td>

                                <!-- Stage 3: Rejected (Active) -->
                                <td width="33%" style="padding:8px;">
                                    <div style="width:52px; height:52px; border-radius:50%;
                                                background:#DC2626; color:#FFFFFF;
                                                line-height:52px; font-weight:bold; margin:0 auto;">
                                        3
                                    </div>
                                    <div style="margin-top:10px; font-weight:bold;">Rejected</div>
                                    <div style="font-size:13px; color:#475569; margin-top:6px;">
                                        Your request was not approved. You should receive a separate email with details and next steps.
                                    </div>
                                </td>
                                {% endif %}

                            </tr>
                        </table>

                    </td>
                </tr>
            </table>
            <hr>
            <!-- Contact Box -->
            <table width="100%" cellpadding="0" cellspacing="0" style="margin:32px 0; background:#fafafa; text-align:center; padding:24px;">
                <tr>
                    <td style="padding:24px;">
                        <div style="font-size:18px; font-weight:bold; color:#0F172A;">Need Assistance?</div>
                        <p style="color:#475569; margin:8px 0;">If you have questions about this status update, our support team is here to help.</p>
                        <a href="mailto:{{ support_email }}" style="display:inline-block; padding:12px 24px; background:#E74C3C; color:#FFFFFF; border-radius:8px; font-weight:bold; margin-top:12px;">Contact Support</a>
                        <p style="margin-top:12px; font-size:14px; color:#6B7280;">Email: <a href="mailto:{{ support_email }}" style="color:#E74C3C;">{{ support_email }}</a></p>
                    </td>
                </tr>
            </table>

        </td>
    </tr>

    <!-- Footer -->
    <tr>
        <td bgcolor="#0F172A" style="padding:36px 32px; text-align:center; color:#94A3B8;">
            <div style="font-weight:bold; color:#FFFFFF;">{{ site_name }}</div>
            <p style="font-size:14px; margin:10px 0;">
                <a href="{{ site_url }}" style="color:#FECACA;">View Request</a> · 
                <a href="{{ portal_url }}" style="color:#FECACA;">Data Portal</a> · 
                <a href="{{ help_url }}" style="color:#FECACA;">Help Center</a>
            </p>
            <p style="font-size:12px;">Automated notification. Do not reply.</p>
            <p style="font-size:12px;">© {% now "Y" %} {{ site_name }}. All rights reserved.</p>
        </td>
    </tr>

</table>

</td>
</tr>
</table>

</body>
</html>
